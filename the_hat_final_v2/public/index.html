<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Hat - Ø°Ø§ Ù‡Ø§Øª</title>
    <link rel="stylesheet" href="style.css">
    <!-- Ù…ÙƒØªØ¨Ø© Socket.io Ù…Ù† CDN Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠØ© */
        #initial-loader {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        .spinner {
            width: 50px; height: 50px;
            border: 5px solid #333;
            border-top: 5px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Ø®ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… */
        .delivered-stamp {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            border: 5px solid #4CAF50;
            color: #4CAF50;
            font-size: 2rem;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 10px;
            opacity: 0.8;
            pointer-events: none;
            z-index: 10;
            background: rgba(0,0,0,0.7);
        }

        /* Ø®ØªÙ… Ø¹Ø¯Ù… Ø§Ù„ØªØ³Ù„ÙŠÙ… */
        .undelivered-stamp {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            border: 5px solid #f44336;
            color: #f44336;
            font-size: 1.5rem;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 10px;
            opacity: 0.8;
            pointer-events: none;
            z-index: 10;
            background: rgba(0,0,0,0.7);
        }

        /* Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù…Ø¤Ù‚Øª */
        .timer-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .timer-text {
            font-size: 1.3rem;
            color: white;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .timer-display {
            font-size: 3rem;
            color: #fff;
            font-weight: bold;
            margin: 15px 0;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.3);
        }
        .timer-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ØªØ¸Ù‡Ø± Ø£ÙˆÙ„ Ø´ÙŠØ¡ -->
    <div id="initial-loader">
        <div class="spinner"></div>
        <h3 style="color: var(--accent-color);">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø·Ø¨Ø®...</h3>
    </div>

    <header>
        <div class="logo-container">
            <!-- Ø§Ù„Ù„ÙˆÙ‚Ùˆ Ø­Ù‚Ùƒ ÙŠØ§ ÙˆØ­Ø´ -->
            <img src="./logo.webp" alt="The Hat Logo" class="logo-img" onerror="this.style.display='none'; document.querySelector('.logo-container').innerText='THE HAT'">
        </div>
        <h1>THE HAT | Ø°Ø§ Ù‡Ø§Øª</h1>
    </header>

    <div class="container">

        <!-- ================= ØµÙØ­Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±Ø¹ ================= -->
        <div id="branch-page" class="page active">
            <h2 style="text-align: center; margin-bottom: 20px; color: #aaa;">Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø£Ù‚Ø±Ø¨ Ù„Ùƒ</h2>
            
            <div class="branch-card" style="margin-bottom: 20px;">
                <button class="btn" onclick="selectBranch('okaz')">ğŸ“ Ø´Ø§Ø±Ø¹ Ø¹ÙƒØ§Ø¸ (Ø§Ù„Ø·Ø§Ø¦Ù)</button>
            </div>
            
            <div class="branch-card">
                <button class="btn" onclick="selectBranch('halqa')">ğŸ“ Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© (Ø§Ù„Ø·Ø§Ø¦Ù)</button>
            </div>

            <div style="margin-top: 40px; text-align: center;">
                <p style="color: #666; font-size: 0.9rem;">Ù…ÙˆØ¸ÙØŸ</p>
                <button onclick="showPage('admin-login')" style="background: none; border: none; color: #444; text-decoration: underline; cursor: pointer;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø·Ø¨Ø®</button>
            </div>
        </div>

        <!-- ================= ØµÙØ­Ø© Ø§Ù„Ù…Ù†ÙŠÙˆ ================= -->
        <div id="menu-page" class="page">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 id="selected-branch-title">Ø§Ù„Ù…Ù†ÙŠÙˆ</h2>
                <button onclick="showPage('branch-page')" style="background: none; border: none; color: #aaa; cursor: pointer;">ØªØºÙŠÙŠØ± Ø§Ù„ÙØ±Ø¹</button>
            </div>

            <!-- Ø²Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙÙŠÙ‡ Ø·Ù„Ø¨ Ù†Ø´Ø·) -->
            <div id="order-status-btn" style="display: none; margin-bottom: 20px;">
                <button onclick="checkOrderStatus()" class="btn" style="background: #2196F3; width: 100%; padding: 12px; font-size: 1.1rem; box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);">
                    ğŸ” Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
                </button>
            </div>

            <div id="menu-items">
                <!-- Ø§Ù„Ø£ØµÙ†Ø§Ù Ø¨ØªÙ†Ø²Ù„ Ù‡Ù†Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>

            <!-- Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© -->
            <div id="cart-float" class="cart-float" style="display: none;" onclick="showPage('checkout-page')">
                <span id="cart-count">0 Ù…Ù†ØªØ¬Ø§Øª</span>
                <span id="cart-total">0 Ø±ÙŠØ§Ù„</span>
                <span>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ &larr;</span>
            </div>
        </div>

        <!-- ================= ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ ÙˆØ¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ================= -->
        <div id="checkout-page" class="page">
            <button onclick="showPage('menu-page')" class="btn btn-secondary" style="margin-bottom: 20px;">&rarr; Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…Ù†ÙŠÙˆ</button>
            
            <h2 style="margin-bottom: 20px; color: var(--accent-color);">Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h2>
            <div id="checkout-items" style="background: #1a1a1a; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ù„Ø© Ù‡Ù†Ø§ -->
            </div>

            <h3 style="margin-bottom: 15px;">Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙŠØ§ ØºØ§Ù„ÙŠ</h3>
            <form id="order-form" onsubmit="submitOrder(event)">
                <div class="form-group">
                    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…</label>
                    <input type="text" id="customer-name" required placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ">
                    <small id="name-error" style="color: var(--danger-color); display: none;">Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨ ÙŠØ§ ØºØ§Ù„ÙŠ</small>
                </div>
                <div class="form-group">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (Ù„Ø§Ø²Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05 ÙˆÙŠÙƒÙˆÙ† 10 Ø£Ø±Ù‚Ø§Ù…)</label>
                    <input type="tel" id="customer-phone" required placeholder="05xxxxxxxx" maxlength="10">
                    <small id="phone-error" style="color: var(--danger-color); display: none;">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„Ø§Ø²Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05 ÙˆÙŠÙƒÙˆÙ† 10 Ø£Ø±Ù‚Ø§Ù…</small>
                </div>
                <div class="form-group">
                    <label>Ù†ÙˆØ¹ ÙˆÙ…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© (Ø¹Ø´Ø§Ù† Ù†Ø¹Ø±ÙÙƒ)</label>
                    <input type="text" id="car-info" required placeholder="Ù…Ø«Ù„Ø§Ù‹: ÙƒØ§Ù…Ø±ÙŠ Ø¨ÙŠØ¶Ø§Ø¡ 2020">
                </div>
                
                <button type="submit" id="submit-btn" class="btn">
                    <span id="btn-text">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ (Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…)</span>
                    <span id="btn-loader" style="display: none;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„... â³</span>
                </button>
            </form>
        </div>

        <!-- ================= ØµÙØ­Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© (ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨) ================= -->
        <div id="invoice-page" class="page">
            <div style="text-align: center; padding: 30px 0;">
                <div style="font-size: 4rem; color: var(--success-color); margin-bottom: 10px;">&#10004;</div>
                <h2 style="color: var(--accent-color);">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h2>
                <p style="color: #aaa; margin-top: 10px;">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: <span id="invoice-id" style="color: white; font-weight: bold;">#</span></p>
            </div>

            <!-- Ø§Ù„Ù…Ø¤Ù‚Øª Ù„Ù„ØªØ¹Ø¯ÙŠÙ„/Ø§Ù„Ø­Ø°Ù -->
            <div id="edit-timer-section" style="display: none;">
                <div class="timer-container">
                    <div class="timer-text">ğŸ˜ ÙˆØ¯Ùƒ ØªØ¹Ø¯Ù„ Ø·Ù„Ø¨ÙƒØŸ ÙŠÙ„Ø§ Ù‚Ø¨Ù„ Ù…Ø§ ÙŠØ®Ù„Øµ Ø§Ù„ÙˆÙ‚Øª!</div>
                    <div class="timer-display" id="timer-display">0:59</div>
                    <div class="timer-buttons">
                        <button onclick="cancelOrder()" class="btn" style="background: #f44336;">âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨</button>
                        <button onclick="editOrder()" class="btn" style="background: #2196F3;">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</button>
                    </div>
                </div>
            </div>

            <div class="order-card" style="text-align: center;">
                <p>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</p>
                <h1 id="invoice-status" style="font-size: 2rem; margin: 15px 0; color: var(--accent-color);">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</h1>
                <p style="font-size: 0.9rem; color: #888;">Ø®Ù„ÙŠÙƒ ÙÙŠ Ù‡Ø§Ù„ØµÙØ­Ø©ØŒ Ø¨ØªØªØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù…Ø§ ÙŠØ¬Ù‡Ø² Ø·Ù„Ø¨Ùƒ</p>
            </div>

            <div style="margin-top: 30px;">
                <h3 style="border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
                <div id="invoice-details"></div>
                <div style="margin-top: 15px; font-weight: bold; font-size: 1.2rem; text-align: left;">
                    Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="invoice-total" style="color: var(--accent-color);">0</span> Ø±ÙŠØ§Ù„
                </div>
            </div>
            
            <!-- Ù‚Ø³Ù… Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ (Ù„Ùˆ ÙÙŠÙ‡ Ø£ÙƒØ«Ø± Ù…Ù† Ø·Ù„Ø¨) -->
            <div id="other-orders-section" style="display: none; margin-top: 30px; border-top: 2px solid #444; padding-top: 20px;">
                <h3 style="color: #aaa; margin-bottom: 15px;">ğŸ“‹ Ø·Ù„Ø¨Ø§ØªÙƒ Ø§Ù„Ø£Ø®Ø±Ù‰:</h3>
                <div id="other-orders-list"></div>
            </div>
            
            <button onclick="goBackToMenu()" class="btn" style="margin-top: 20px; background: #4CAF50;">ğŸ½ï¸ ÙˆØ¯Ùƒ ØªØ±Ø¬Ø¹ Ù„Ù„Ù…Ù†ÙŠÙˆ Ù„ÙŠÙ† ÙŠØ¬Ù‡Ø² Ø·Ù„Ø¨ÙƒØŸ</button>
            <button onclick="startNewOrder()" class="btn btn-secondary" style="margin-top: 10px;">Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
        </div>

        <!-- ================= ØµÙØ­Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† ================= -->
        <div id="admin-login" class="page">
            <h2 style="text-align: center; margin-bottom: 20px;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø·Ø¨Ø® / Ø§Ù„ÙƒØ§Ø´ÙŠØ±</h2>
            <div class="form-group">
                <label>Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ</label>
                <input type="password" id="admin-pin" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø²" style="text-align: center; letter-spacing: 5px; font-size: 1.5rem;">
            </div>
            <button onclick="checkAdminPin()" class="btn">Ø¯Ø®ÙˆÙ„</button>
            <button onclick="showPage('branch-page')" class="btn btn-secondary">Ø±Ø¬ÙˆØ¹</button>
        </div>

        <!-- ================= ØµÙØ­Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ø§Ù„Ù…Ø·Ø¨Ø®) ================= -->
        <div id="admin-dashboard" class="page">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px;">
                <h2>ğŸ‘¨â€ğŸ³ Ø§Ù„Ù…Ø·Ø¨Ø® (Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­ÙŠØ©)</h2>
                <div>
                    <button onclick="enableSound()" id="sound-btn" style="background: #333; color: white; border: none; padding: 5px 10px; border-radius: 4px; margin-left: 5px;">ğŸ”Š ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª</button>
                    <button onclick="showPage('branch-page')" style="background: #333; color: white; border: none; padding: 5px 10px; border-radius: 4px;">Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>

            <div id="admin-orders-list">
                <p style="text-align: center; color: #666; margin-top: 50px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹...</p>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© -->
            <div style="margin-top: 40px; border-top: 2px solid #4CAF50; padding-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: #4CAF50; margin: 0;">âœ… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© (ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…)</h3>
                    <button onclick="clearCompleted()" style="background: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">ğŸ—‘ï¸ ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
                </div>
                <div id="completed-orders-list">
                    <p style="text-align: center; color: #666; margin-top: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©...</p>
                </div>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø³Ù„Ù…Ø© -->
            <div style="margin-top: 40px; border-top: 2px solid #f44336; padding-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: #f44336; margin: 0;">âŒ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø³Ù„Ù…Ø© (Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù… ÙŠØ³ØªÙ„Ù…)</h3>
                    <button onclick="clearUndelivered()" style="background: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">ğŸ—‘ï¸ ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
                </div>
                <div id="undelivered-orders-list">
                    <p style="text-align: center; color: #666; margin-top: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ù…Ø³Ù„Ù…Ø©...</p>
                </div>
            </div>
        </div>

    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ -->
    <div id="location-modal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 15px; color: var(--accent-color);">ØªÙˆØ¬ÙŠÙ‡ Ù„Ù„ÙØ±Ø¹</h3>
            <p style="margin-bottom: 20px;">ØªØ¨ÙŠ Ù†ÙØªØ­ Ù„Ùƒ Ù‚ÙˆÙ‚Ù„ Ù…Ø§Ø¨ ÙˆÙ„Ø§ ØªØ¯Ù„ Ø§Ù„Ø·Ø±ÙŠÙ‚ØŸ</p>
            <button id="maps-btn" class="btn">ÙˆØ¯Ù†ÙŠ Ù„Ù„Ù…ÙˆÙ‚Ø¹ (Google Maps)</button>
            <button onclick="closeModalAndGoToMenu()" class="btn btn-secondary">Ø£Ø¹Ø±Ù Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ ÙƒÙ…Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
        </div>
    </div>

    <!-- ØµÙˆØª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ (Ù…Ø®ÙÙŠ) -->
    <audio id="notification-sound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <script>
        // ================= Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ù…Ù†ÙŠÙˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©) =================
        const menuItems = [
            // 1. Ù‚Ø³Ù… Ø§Ù„ÙˆØ¬Ø¨Ø§Øª ÙˆØ§Ù„Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª
            { id: 1, name: "Ù‡Ø§Øª ÙˆØ¬Ø¨Ø© Ù„Ø­Ù… (950 cal)", price: 23, category: "ÙˆØ¬Ø¨Ø§Øª" },
            { id: 2, name: "Ù‡Ø§Øª ÙˆØ¬Ø¨Ø© Ø¯Ø¬Ø§Ø¬ (830 cal)", price: 21, category: "ÙˆØ¬Ø¨Ø§Øª" },
            { id: 3, name: "Ù‡Ø§Øª Ø´ÙˆØ³ Ù„Ø­Ù… (490 cal)", price: 16, category: "Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª" },
            { id: 4, name: "Ù‡Ø§Øª Ø´ÙˆØ³ Ø¯Ø¬Ø§Ø¬ (400 cal)", price: 14, category: "Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª" },
            { id: 5, name: "Ù‡Ø§Øª Ø¨Ø±Ø¬Ø± Ù„Ø­Ù… (450 cal)", price: 14, category: "Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª" },
            { id: 6, name: "Ù‡Ø§Øª Ø¨Ø±Ø¬Ø± Ø¯Ø¬Ø§Ø¬ (360 cal)", price: 12, category: "Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª" },
            { id: 7, name: "Ù‡Ø§Øª Ø³ØªÙŠÙƒ (Ù„Ø­Ù…/Ø¯Ø¬Ø§Ø¬)", price: 13, category: "Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª" },
            { id: 8, name: "Ù‡Ø§Øª Ø³ØªÙŠÙƒ ÙˆØ¬Ø¨Ø©", price: 23, category: "ÙˆØ¬Ø¨Ø§Øª" },
            { id: 9, name: "Ù‡Ø§Øª Ø­Ø³Ù†ÙŠ (350 cal)", price: 16, category: "Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª" },
            { id: 10, name: "Ù‡Ø§Øª Ø­Ø³Ù†ÙŠ ÙˆØ¬Ø¨Ø©", price: 18, category: "ÙˆØ¬Ø¨Ø§Øª" },
            { id: 11, name: "Ù‡Ø§Øª Ø³Ø¨ÙŠØ´Ù„ Ø­Ø³Ù†ÙŠ (390 cal)", price: 18, category: "Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª" },

            // 2. Ù‚Ø³Ù… Ù‡Ø§Øª Ø¨Ø·Ø§Ø·Ø³
            { id: 12, name: "Ø¨Ø·Ø§Ø·Ø³ ÙˆÙŠØ¯Ø¬Ø± (200 cal)", price: 9, category: "Ø¨Ø·Ø§Ø·Ø³" },
            { id: 13, name: "Ø¨Ø·Ø§Ø·Ø³ Ø¨Ø§Ù„Ø¨ØµÙ„ Ø§Ù„Ù…Ù‚Ø±Ù…Ø´ (220 cal)", price: 11, category: "Ø¨Ø·Ø§Ø·Ø³" },
            { id: 14, name: "Ø¨Ø·Ø§Ø·Ø³ Ø¨Ø§Ù„Ù„Ø­Ù… Ø§Ù„Ù…ÙØ±ÙˆÙ… (245 cal)", price: 12, category: "Ø¨Ø·Ø§Ø·Ø³" },
            { id: 15, name: "Ø¨Ø·Ø§Ø·Ø³ Ù…ÙƒØ¹Ø¨Ø§Øª (200 cal)", price: 10, category: "Ø¨Ø·Ø§Ø·Ø³" },
            { id: 16, name: "Ø¨Ø·Ø§Ø·Ø³ Ø­Ù„ÙˆØ© Ù…Ø¹ ØµÙˆØµ ØªÙƒØ³Ø§Ø³ (130 cal)", price: 11, category: "Ø¨Ø·Ø§Ø·Ø³" },
            { id: 17, name: "Ø¨Ø·Ø§Ø·Ø³ Ø¨Ø§Ù„Ø¯Ø¬Ø§Ø¬ Ø§Ù„Ù…ÙØ±ÙˆÙ… (238 cal)", price: 12, category: "Ø¨Ø·Ø§Ø·Ø³" },

            // 3. Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª
            { id: 18, name: "ØµÙˆØµ Ø°Ø§ Ù‡Ø§Øª", price: 2, category: "Ø¥Ø¶Ø§ÙØ§Øª" },
            { id: 19, name: "ØµÙˆØµ ØªÙƒØ³Ø§Ø³", price: 2, category: "Ø¥Ø¶Ø§ÙØ§Øª" },
            { id: 20, name: "ØµÙˆØµ Ø¬Ø¨Ù†", price: 2, category: "Ø¥Ø¶Ø§ÙØ§Øª" },
            { id: 21, name: "Ù‡Ù„Ø§Ø¨ÙŠÙ†Ùˆ", price: 2, category: "Ø¥Ø¶Ø§ÙØ§Øª" },
            { id: 22, name: "Ø´Ø±ÙŠØ­Ø© Ø¬Ø¨Ù†", price: 2, category: "Ø¥Ø¶Ø§ÙØ§Øª" },
            { id: 23, name: "Ø¨ØµÙ„ Ù…Ù‚Ø±Ù…Ø´", price: 2, category: "Ø¥Ø¶Ø§ÙØ§Øª" },
            { id: 24, name: "Ø´ÙŠØªÙˆØ³", price: 2, category: "Ø¥Ø¶Ø§ÙØ§Øª" },

            // 4. Ù‚Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª
            { id: 25, name: "Ø¨ÙŠØ¨Ø³ÙŠ", price: 4, category: "Ù…Ø´Ø±ÙˆØ¨Ø§Øª" },
            { id: 26, name: "Ø¯ÙŠÙˆ", price: 4, category: "Ù…Ø´Ø±ÙˆØ¨Ø§Øª" },
            { id: 27, name: "Ø³ÙÙ† Ø£Ø¨", price: 4, category: "Ù…Ø´Ø±ÙˆØ¨Ø§Øª" },
            { id: 28, name: "Ù…ÙŠØ±Ù†Ø¯Ø§", price: 4, category: "Ù…Ø´Ø±ÙˆØ¨Ø§Øª" },
            { id: 29, name: "Ù…Ø§Ø¡", price: 1, category: "Ù…Ø´Ø±ÙˆØ¨Ø§Øª" }
        ];

        // ================= Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© =================
        let cart = [];
        let selectedBranch = '';
        // Ù†Ø®Ø²Ù† Ù‚Ø§Ø¦Ù…Ø© Ø¨ÙƒÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ† (Ù…Ø´ Ø·Ù„Ø¨ ÙˆØ§Ø­Ø¯ Ø¨Ø³)
        let myOrders = JSON.parse(localStorage.getItem('myOrders') || '[]');
        let currentOrderId = localStorage.getItem('currentOrderId'); // Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§Ù„Ù„ÙŠ ÙŠØ´ÙˆÙÙ‡
        let allOrders = [];
        
        // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±
        const socket = io();

        // ================= Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙØ­Ø§Øª =================
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            // Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¹Ø´Ø§Ù† Ù„Ùˆ Ø³ÙˆÙ‰ ØªØ­Ø¯ÙŠØ«
            if (pageId !== 'initial-loader') {
                localStorage.setItem('currentPage', pageId);
            }

            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ (ÙÙ‚Ø· ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…Ù†ÙŠÙˆ ÙˆØ¥Ø°Ø§ ÙÙŠÙ‡ Ø·Ù„Ø¨Ø§Øª)
            const orderStatusBtn = document.getElementById('order-status-btn');
            if (pageId === 'menu-page' && myOrders.length > 0) {
                orderStatusBtn.style.display = 'block';
                updateOrderStatusButton(); // Ù†Ø­Ø¯Ø« Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø²Ø±
            } else {
                orderStatusBtn.style.display = 'none';
            }
        }

        // ================= Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ =================
        function selectBranch(branch) {
            selectedBranch = branch;
            localStorage.setItem('selectedBranch', branch); // Ø­ÙØ¸ Ø§Ù„ÙØ±Ø¹
            
            document.getElementById('selected-branch-title').innerText = 
                branch === 'okaz' ? 'Ù…Ù†ÙŠÙˆ ÙØ±Ø¹ Ø´Ø§Ø±Ø¹ Ø¹ÙƒØ§Ø¸' : 'Ù…Ù†ÙŠÙˆ ÙØ±Ø¹ Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©';
            
            renderMenu();
            
            // ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø­Ù‚ Ø§Ù„Ù…ÙˆÙ‚Ø¹
            const modal = document.getElementById('location-modal');
            const mapsBtn = document.getElementById('maps-btn');
            
            if (branch === 'okaz') {
                mapsBtn.onclick = () => window.open('https://maps.app.goo.gl/jFUD34KidKubSsNR7', '_blank');
            } else {
                mapsBtn.onclick = () => window.open('https://maps.app.goo.gl/j8BojykPyXVKNYV38', '_blank');
            }
            
            modal.style.display = 'flex';
        }

        function closeModalAndGoToMenu() {
            document.getElementById('location-modal').style.display = 'none';
            showPage('menu-page');
        }

        function renderMenu() {
            const container = document.getElementById('menu-items');
            container.innerHTML = '';
            
            const categories = [...new Set(menuItems.map(item => item.category))];
            
            categories.forEach(cat => {
                const catTitle = document.createElement('h3');
                catTitle.style.color = 'var(--accent-color)';
                catTitle.style.marginTop = '20px';
                catTitle.style.borderBottom = '1px solid #333';
                catTitle.innerText = cat;
                container.appendChild(catTitle);
                
                menuItems.filter(i => i.category === cat).forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'menu-item';
                    div.innerHTML = `
                        <div>
                            <div style="font-weight: bold;">${item.name}</div>
                            <div style="color: var(--accent-color);">${item.price} Ø±ÙŠØ§Ù„</div>
                        </div>
                        <button class="btn" style="width: auto; padding: 5px 15px;" onclick="addToCart(${item.id})">Ø¥Ø¶Ø§ÙØ© +</button>
                    `;
                    container.appendChild(div);
                });
            });
        }

        function addToCart(itemId) {
            const item = menuItems.find(i => i.id === itemId);
            cart.push(item);
            updateCartUI();
        }

        function updateCartUI() {
            const float = document.getElementById('cart-float');
            const count = document.getElementById('cart-count');
            const total = document.getElementById('cart-total');
            
            if (cart.length > 0) {
                float.style.display = 'flex';
                count.innerText = `${cart.length} Ù…Ù†ØªØ¬Ø§Øª`;
                const sum = cart.reduce((a, b) => a + b.price, 0);
                total.innerText = `${sum} Ø±ÙŠØ§Ù„`;
                
                // ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ ÙƒÙ…Ø§Ù†
                const checkoutItems = document.getElementById('checkout-items');
                checkoutItems.innerHTML = cart.map(item => `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px;">
                        <span>${item.name}</span>
                        <span>${item.price} Ø±ÙŠØ§Ù„</span>
                    </div>
                `).join('');
                
                checkoutItems.innerHTML += `
                    <div style="margin-top: 15px; font-weight: bold; font-size: 1.2rem; text-align: left;">
                        Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span style="color: var(--accent-color);">${sum}</span> Ø±ÙŠØ§Ù„
                    </div>
                `;
            } else {
                float.style.display = 'none';
            }
        }

        function submitOrder(e) {
            e.preventDefault();
            
            const name = document.getElementById('customer-name').value;
            const phone = document.getElementById('customer-phone').value;
            const car = document.getElementById('car-info').value;
            
            // ØªØ­Ù‚Ù‚ Ø¨Ø³ÙŠØ·
            if (!name) {
                document.getElementById('name-error').style.display = 'block';
                return;
            }
            if (!phone.startsWith('05') || phone.length !== 10) {
                document.getElementById('phone-error').style.display = 'block';
                return;
            }
            
            // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„ÙˆØ¯Ø±
            const btn = document.getElementById('submit-btn');
            btn.disabled = true;
            document.getElementById('btn-text').style.display = 'none';
            document.getElementById('btn-loader').style.display = 'inline';
            
            const orderData = {
                customerName: name,
                phone: phone,
                carInfo: car,
                branch: selectedBranch,
                items: cart,
                total: cart.reduce((a, b) => a + b.price, 0),
                status: 'pending',
                timestamp: new Date().toISOString()
            };
            
            // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø³ÙŠØ±ÙØ±
            socket.emit('new-order', orderData);
        }

        // ================= Ø£Ø¯Ù…Ù† / Ù…Ø·Ø¨Ø® =================
        function checkAdminPin() {
            const pin = document.getElementById('admin-pin').value;
            if (pin === '1234') {
                showPage('admin-dashboard');
                renderAdminOrders(allOrders);
            } else {
                alert('Ø§Ù„Ø±Ù…Ø² ØºÙ„Ø· ÙŠØ§ Ø§Ù„Ø­Ø¨ÙŠØ¨!');
            }
        }

        function getShortId(longId) {
            // Ù„Ùˆ Ø§Ù„Ø±Ù‚Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ù€ ORD- Ù†Ø±Ø¬Ø¹ Ø§Ù„Ø±Ù‚Ù… Ø¨Ø³
            if (longId.startsWith('ORD-')) {
                return longId.replace('ORD-', '');
            }
            // Ù„Ùˆ Ù…Ø§ÙÙŠÙ‡ ORD Ù†Ø±Ø¬Ø¹ Ø£ÙˆÙ„ 4 Ø£Ø­Ø±Ù
            return longId.slice(0, 4).toUpperCase();
        }

        function renderAdminOrders(orders) {
            const list = document.getElementById('admin-orders-list');
            
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¤Ø±Ø´ÙØ© (Ù…Ø§ Ù†Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
            const activeOrders = orders.filter(o => o.status !== 'archived');
            
            if (activeOrders.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; margin-top: 50px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹...</p>';
                return;
            }
            
            // ØªØ±ØªÙŠØ¨: Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙˆÙ‚
            activeOrders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            list.innerHTML = activeOrders.map(order => {
                const timeAgo = Math.floor((new Date() - new Date(order.timestamp)) / 60000);
                
                // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„ÙƒØ±Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø©
                let cardStyle = '';
                let stamp = '';
                
                if (order.status === 'delivered') {
                    cardStyle = 'border: 2px solid #4CAF50; background: #1a331a;'; // Ø£Ø®Ø¶Ø± ØºØ§Ù…Ù‚
                    stamp = '<div class="delivered-stamp">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</div>';
                } else if (order.status === 'ready') {
                    cardStyle = 'border: 2px solid var(--accent-color);';
                }

                return `
                <div class="order-card" style="position: relative; ${cardStyle}">
                    ${stamp}
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <div>
                            <h3 style="margin: 0; color: var(--accent-color);">${order.customerName}</h3>
                            <div style="font-size: 0.9rem; color: #fff;">ğŸ“± ${order.phone}</div>
                            <div style="font-size: 0.9rem; color: #aaa;">ğŸš— ${order.carInfo}</div>
                        </div>
                        <div style="text-align: left;">
                            <div style="font-weight: bold; font-size: 1.2rem;">#${getShortId(order.id)}</div>
                            <div style="font-size: 0.8rem; color: #666;">Ù…Ù†Ø° ${timeAgo} Ø¯Ù‚ÙŠÙ‚Ø©</div>
                            <div style="font-size: 0.8rem; color: var(--accent-color); margin-top: 5px;">${order.branch === 'okaz' ? 'Ø´Ø§Ø±Ø¹ Ø¹ÙƒØ§Ø¸' : 'Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©'}</div>
                        </div>
                    </div>

                    <div style="background: #222; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
                        ${order.items.map(item => `
                            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 3px;">
                                <span>${item.name}</span>
                                <span>${item.price}</span>
                            </div>
                        `).join('')}
                        <div style="border-top: 1px solid #444; margin-top: 5px; padding-top: 5px; font-weight: bold; text-align: left;">
                            Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${order.total} Ø±ÙŠØ§Ù„
                        </div>
                    </div>

                    ${order.status !== 'delivered' && order.status !== 'completed' && order.status !== 'undelivered' ? `
                    <div class="action-buttons">
                        ${order.status === 'pending' ? `<button onclick="updateStatus('${order.id}', 'preparing')" class="btn" style="background: #2196F3;">ğŸ‘¨â€ğŸ³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±</button>` : ''}
                        ${order.status === 'preparing' ? `<button onclick="updateStatus('${order.id}', 'ready')" class="btn" style="background: var(--success-color);">âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…</button>` : ''}
                        ${order.status === 'ready' ? `
                            <button onclick="updateStatus('${order.id}', 'completed')" class="btn" style="background: #4CAF50;">ğŸ¤ ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
                            <button onclick="updateStatus('${order.id}', 'undelivered')" class="btn" style="background: #f44336; margin-top: 5px;">âŒ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù… ÙŠØ³ØªÙ„Ù… Ø§Ù„Ø·Ù„Ø¨</button>
                        ` : ''}
                    </div>
                    ` : ''}
                </div>
            `;
            }).join('');
        }

        function getStatusText(status) {
            if (status === 'pending') return 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...';
            if (status === 'preparing') return 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¬Ù‡ÙŠØ² ğŸ³';
            if (status === 'ready') return 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… âœ…';
            if (status === 'delivered') return 'ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ğŸ‰';
            if (status === 'completed') return 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… âœ…';
            if (status === 'undelivered') return 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… âŒ';
            return status;
        }

        function updateStatus(orderId, status) {
            // Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù„Ø³ÙŠØ±ÙØ±
            socket.emit('update-status', { orderId, status });
        }

        // Ø¯ÙˆØ§Ù„ ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
        function clearCompleted() {
            if (confirm('Ù…ØªØ£ÙƒØ¯ ØªØ¨ÙŠ ØªØ­Ø°Ù ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©ØŸ')) {
                socket.emit('clear-completed');
            }
        }

        // Ø¯Ø§Ù„Ø© ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø³Ù„Ù…Ø©
        function clearUndelivered() {
            if (confirm('Ù…ØªØ£ÙƒØ¯ ØªØ¨ÙŠ ØªØ­Ø°Ù ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø³Ù„Ù…Ø©ØŸ')) {
                socket.emit('clear-undelivered');
            }
        }

        function enableSound() {
            const audio = document.getElementById('notification-sound');
            audio.play().then(() => {
                audio.pause();
                audio.currentTime = 0;
                document.getElementById('sound-btn').innerText = 'âœ… Ø§Ù„ØµÙˆØª Ù…ÙØ¹Ù„';
                document.getElementById('sound-btn').style.color = '#4CAF50';
            }).catch(e => alert('Ù„Ø§Ø²Ù… ØªØ¶ØºØ· Ø¹Ø´Ø§Ù† Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØµÙˆØª'));
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…Ù†ÙŠÙˆ Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø­ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        function goBackToMenu() {
            showPage('menu-page');
        }

        function startNewOrder() {
            // Ù†Ù…Ø³Ø­ ÙƒÙ„ Ø´ÙŠ Ù…ØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù‚Ø¯ÙŠÙ…
            localStorage.removeItem('currentOrderId');
            localStorage.removeItem('orderTime');
            localStorage.removeItem('currentPage');
            currentOrderId = null;
            cart = [];
            
            // Ù†ÙˆÙ‚Ù Ø§Ù„Ù…Ø¤Ù‚Øª Ù„Ùˆ Ø´ØºØ§Ù„
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            showPage('branch-page');
        }

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø¤Ù‚Øª
        let timerInterval = null;
        let timerOrderId = null; // Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù„ÙŠ Ù„Ù‡ Ù…Ø¤Ù‚Øª Ù†Ø´Ø·
        let timerHasEnded = {}; // Ø³Ø¬Ù„ Ø¨Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù„ÙŠ Ø®Ù„Øµ Ù…Ø¤Ù‚ØªÙ‡Ø§

        // Ø¯Ø§Ù„Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª (ÙÙ‚Ø· Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
        function startEditTimer(orderId, orderTime) {
            const timerSection = document.getElementById('edit-timer-section');
            const timerDisplay = document.getElementById('timer-display');
            
            // Ù„Ùˆ Ø§Ù„Ù…Ø¤Ù‚Øª Ø®Ù„Øµ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŒ Ù…Ø§Ù†Ø´ØºÙ„Ù‡ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©
            if (timerHasEnded[orderId]) {
                timerSection.style.display = 'none';
                return;
            }
            
            // Ù„Ùˆ ÙÙŠÙ‡ Ù…Ø¤Ù‚Øª Ø´ØºØ§Ù„ Ù„Ø·Ù„Ø¨ Ø«Ø§Ù†ÙŠØŒ Ù†ÙˆÙ‚ÙÙ‡
            if (timerInterval && timerOrderId !== orderId) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // Ù„Ùˆ Ø§Ù„Ù…Ø¤Ù‚Øª Ø´ØºØ§Ù„ Ù„Ù†ÙØ³ Ø§Ù„Ø·Ù„Ø¨ØŒ Ù…Ø§Ù†Ø´ØºÙ„Ù‡ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©
            if (timerInterval && timerOrderId === orderId) {
                return;
            }
            
            if (!orderId || !orderTime) return;
            
            const elapsed = Math.floor((Date.now() - orderTime) / 1000);
            let timeRemaining = 59 - elapsed;
            
            if (timeRemaining <= 0) {
                timerSection.style.display = 'none';
                timerHasEnded[orderId] = true;
                return;
            }
            
            timerSection.style.display = 'block';
            timerOrderId = orderId;
            
            // Ù†Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø©
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            timerDisplay.innerText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ù‚Øª ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
            timerInterval = setInterval(() => {
                timeRemaining--;
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    timerOrderId = null;
                    timerSection.style.display = 'none';
                    timerHasEnded[orderId] = true;
                    return;
                }
                
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                timerDisplay.innerText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // Ø¯Ø§Ù„Ø© Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨
        function cancelOrder() {
            if (confirm('Ù…ØªØ£ÙƒØ¯ ØªØ¨ÙŠ ØªÙ„ØºÙŠ Ø§Ù„Ø·Ù„Ø¨ØŸ')) {
                socket.emit('cancel-order', currentOrderId);
                
                // Ù†Ø´ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                myOrders = myOrders.filter(id => id !== currentOrderId);
                localStorage.setItem('myOrders', JSON.stringify(myOrders));
                
                // Ù†Ø­Ø°Ù ÙˆÙ‚Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡
                localStorage.removeItem('orderTime_' + currentOrderId);
                
                currentOrderId = null;
                localStorage.removeItem('currentOrderId');
                localStorage.removeItem('orderTime');
                
                cart = [];
                clearInterval(timerInterval);
                
                alert('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
                updateOrderStatusButton();
                showPage('branch-page');
            }
        }

        // Ø¯Ø§Ù„Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
        function editOrder() {
            if (confirm('Ø¨Ù†Ø±Ø¬Ø¹Ùƒ Ù„Ù„Ù…Ù†ÙŠÙˆ Ø¹Ø´Ø§Ù† ØªØ¹Ø¯Ù„ Ø·Ù„Ø¨Ùƒ. Ù…ØªØ£ÙƒØ¯ØŸ')) {
                socket.emit('cancel-order', currentOrderId);
                
                // Ù†Ø´ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                myOrders = myOrders.filter(id => id !== currentOrderId);
                localStorage.setItem('myOrders', JSON.stringify(myOrders));
                
                // Ù†Ø­Ø°Ù ÙˆÙ‚Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡
                localStorage.removeItem('orderTime_' + currentOrderId);
                
                currentOrderId = null;
                localStorage.removeItem('currentOrderId');
                localStorage.removeItem('orderTime');
                
                clearInterval(timerInterval);
                updateOrderStatusButton();
                showPage('menu-page');
            }
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
        function updateOrderStatusButton() {
            const orderStatusBtn = document.getElementById('order-status-btn');
            if (!orderStatusBtn) return;
            
            // Ù†Ø¬ÙŠØ¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø© ÙÙ‚Ø· (pending, preparing, ready)
            const activeOrders = myOrders.map(id => allOrders.find(o => o.id === id))
                .filter(o => o && ['pending', 'preparing', 'ready'].includes(o.status));
            
            // Ù„Ùˆ ÙÙŠÙ‡ Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø©ØŒ Ù†Ø¸Ù‡Ø± Ø§Ù„Ø²Ø±
            if (activeOrders.length > 0) {
                orderStatusBtn.style.display = 'block';
            } else {
                orderStatusBtn.style.display = 'none';
            }
        }

        // Ø¯Ø§Ù„Ø© ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
        function checkOrderStatus() {
            if (myOrders.length === 0) {
                alert('Ù…Ø§ ÙÙŠÙ‡ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ©!');
                return;
            }
            
            // Ù„Ùˆ ÙÙŠÙ‡ Ø·Ù„Ø¨ Ø­Ø§Ù„ÙŠØŒ Ù†Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ«Ù‡
            if (currentOrderId) {
                socket.emit('request-order-status', currentOrderId);
                showPage('invoice-page');
            } else if (myOrders.length > 0) {
                // Ù„Ùˆ Ù…Ø§ÙÙŠÙ‡ Ø·Ù„Ø¨ Ø­Ø§Ù„ÙŠØŒ Ù†Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ø·Ù„Ø¨
                currentOrderId = myOrders[myOrders.length - 1];
                localStorage.setItem('currentOrderId', currentOrderId);
                socket.emit('request-order-status', currentOrderId);
                showPage('invoice-page');
            }
        }

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
        function renderCompletedOrders(orders) {
            const list = document.getElementById('completed-orders-list');
            
            if (orders.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; margin-top: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©...</p>';
                return;
            }
            
            // ØªØ±ØªÙŠØ¨: Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙˆÙ‚
            orders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            list.innerHTML = orders.map(order => {
                const timeAgo = Math.floor((new Date() - new Date(order.timestamp)) / 60000);
                
                return `
                <div class="order-card" style="position: relative; border: 2px solid #4CAF50; background: #1a331a;">
                    <div class="delivered-stamp">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <div>
                            <h3 style="margin: 0; color: var(--accent-color);">${order.customerName}</h3>
                            <div style="font-size: 0.9rem; color: #fff;">ğŸ“± ${order.phone}</div>
                            <div style="font-size: 0.9rem; color: #aaa;">ğŸš— ${order.carInfo}</div>
                        </div>
                        <div style="text-align: left;">
                            <div style="font-weight: bold; font-size: 1.2rem;">#${getShortId(order.id)}</div>
                            <div style="font-size: 0.8rem; color: #666;">Ù…Ù†Ø° ${timeAgo} Ø¯Ù‚ÙŠÙ‚Ø©</div>
                            <div style="font-size: 0.8rem; color: var(--accent-color); margin-top: 5px;">${order.branch === 'okaz' ? 'Ø´Ø§Ø±Ø¹ Ø¹ÙƒØ§Ø¸' : 'Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©'}</div>
                        </div>
                    </div>

                    <div style="background: #222; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
                        ${order.items.map(item => `
                            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 3px;">
                                <span>${item.name}</span>
                                <span>${item.price}</span>
                            </div>
                        `).join('')}
                        <div style="border-top: 1px solid #444; margin-top: 5px; padding-top: 5px; font-weight: bold; text-align: left;">
                            Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${order.total} Ø±ÙŠØ§Ù„
                        </div>
                    </div>
                </div>
            `;
            }).join('');
        }

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø³Ù„Ù…Ø©
        function renderUndeliveredOrders(orders) {
            const list = document.getElementById('undelivered-orders-list');
            
            if (orders.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; margin-top: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ù…Ø³Ù„Ù…Ø©...</p>';
                return;
            }
            
            // ØªØ±ØªÙŠØ¨: Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙˆÙ‚
            orders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            list.innerHTML = orders.map(order => {
                const timeAgo = Math.floor((new Date() - new Date(order.timestamp)) / 60000);
                
                return `
                <div class="order-card" style="position: relative; border: 2px solid #f44336; background: #331a1a;">
                    <div class="undelivered-stamp">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <div>
                            <h3 style="margin: 0; color: var(--accent-color);">${order.customerName}</h3>
                            <div style="font-size: 0.9rem; color: #fff;">ğŸ“± ${order.phone}</div>
                            <div style="font-size: 0.9rem; color: #aaa;">ğŸš— ${order.carInfo}</div>
                        </div>
                        <div style="text-align: left;">
                            <div style="font-weight: bold; font-size: 1.2rem;">#${getShortId(order.id)}</div>
                            <div style="font-size: 0.8rem; color: #666;">Ù…Ù†Ø° ${timeAgo} Ø¯Ù‚ÙŠÙ‚Ø©</div>
                            <div style="font-size: 0.8rem; color: var(--accent-color); margin-top: 5px;">${order.branch === 'okaz' ? 'Ø´Ø§Ø±Ø¹ Ø¹ÙƒØ§Ø¸' : 'Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©'}</div>
                        </div>
                    </div>

                    <div style="background: #222; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
                        ${order.items.map(item => `
                            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 3px;">
                                <span>${item.name}</span>
                                <span>${item.price}</span>
                            </div>
                        `).join('')}
                        <div style="border-top: 1px solid #444; margin-top: 5px; padding-top: 5px; font-weight: bold; text-align: left;">
                            Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${order.total} Ø±ÙŠØ§Ù„
                        </div>
                    </div>
                </div>
            `;
            }).join('');
        }

        // ================= Socket.io Listeners (Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„Ù†Ø§Ø¨Ø¶) =================
        
        socket.on('connect', () => {
            console.log('Connected to server');
            // Ù†Ø®ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù…Ø§ Ù†ØªØµÙ„
            document.getElementById('initial-loader').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('initial-loader').style.display = 'none';
            }, 500);

            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
            const savedPage = localStorage.getItem('currentPage');
            const savedBranch = localStorage.getItem('selectedBranch');
            
            if (savedBranch) {
                selectedBranch = savedBranch;
                renderMenu(); // Ø¹Ø´Ø§Ù† Ù†Ø¹Ø¨ÙŠ Ø§Ù„Ù…Ù†ÙŠÙˆ Ù„Ùˆ ÙƒØ§Ù† ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…Ù†ÙŠÙˆ
            }

            // Ù„Ùˆ Ø§Ù„Ø²Ø¨ÙˆÙ† Ø¹Ù†Ø¯Ù‡ Ø·Ù„Ø¨ØŒ Ù†Ø­Ø¯Ø« Ø­Ø§Ù„ØªÙ‡ ÙˆÙ†ÙˆØ¯ÙŠÙ‡ Ù„Ù„ÙØ§ØªÙˆØ±Ø©
            if (myOrderId) {
                // Ù†Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ù‡Ø°Ø§ ØªØ­Ø¯ÙŠØ¯Ø§Ù‹
                socket.emit('request-order-status', myOrderId);
            } else if (savedPage && savedPage !== 'invoice-page') {
                // Ù„Ùˆ Ù…Ø§ Ø¹Ù†Ø¯Ù‡ Ø·Ù„Ø¨ØŒ Ù†Ø±Ø¬Ø¹Ù‡ Ù„ØµÙØ­ØªÙ‡ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© (Ø¥Ù„Ø§ Ù„Ùˆ ÙƒØ§Ù†Øª ÙØ§ØªÙˆØ±Ø© ÙˆÙ‡Ùˆ Ù…Ø§ Ø¹Ù†Ø¯Ù‡ Ø·Ù„Ø¨)
                showPage(savedPage);
            }
        });

        // Ù„Ùˆ Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ù…Ø§Ù†Ø¸Ù‡Ø± Ø´ÙŠ Ù„Ù„Ø²Ø¨ÙˆÙ† (ÙŠØ¹ÙŠØ¯ Ø§Ù„Ø§ØªØµØ§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
        socket.on('disconnect', () => {
            console.log('Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ - Ø³ÙŠØ¹ÙŠØ¯ Ø§Ù„Ø§ØªØµØ§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹');
            // Ù…Ø§Ù†Ø¸Ù‡Ø± Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ø´Ø§Ù† Ù…Ø§ÙŠØ²Ø¹Ø¬ Ø§Ù„Ø²Ø¨ÙˆÙ†
        });
        
        // Ù„Ù…Ø§ ÙŠØ±Ø¬Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„
        socket.on('reconnect', () => {
            console.log('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­');
        });

        // Ø£ÙˆÙ„ Ù…Ø§ Ù†Ø´Ø¨ÙƒØŒ Ù†Ø³ØªÙ„Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
        socket.on('initial-orders', (orders) => {
            console.log('Initial orders received:', orders.length);
            allOrders = orders; 
            renderAdminOrders(orders);
        });

        // ØªØ£ÙƒÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø²Ø¨ÙˆÙ† (Ø¹Ø´Ø§Ù† Ù†ÙˆÙ‚Ù Ø§Ù„Ù„ÙˆØ¯ÙŠÙ†Ù‚)
        socket.on('order-confirmed', (orderId) => {
            console.log('ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¨Ø±Ù‚Ù…:', orderId);
            
            // Ù†Ø¶ÙŠÙ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†
            if (!myOrders.includes(orderId)) {
                myOrders.push(orderId);
                localStorage.setItem('myOrders', JSON.stringify(myOrders));
            }
            
            // Ù†Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
            currentOrderId = orderId;
            localStorage.setItem('currentOrderId', orderId);
            
            // Ù†Ø­ÙØ¸ ÙˆÙ‚Øª Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„ Ù„ÙƒÙ„ Ø·Ù„Ø¨
            const orderTimeNow = Date.now();
            localStorage.setItem('orderTime_' + orderId, orderTimeNow.toString());
            localStorage.setItem('orderTime', orderTimeNow.toString()); // Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…
            
            // Ù†ÙˆÙ‚Ù Ø§Ù„Ù„ÙˆØ¯ÙŠÙ†Ù‚ ÙˆÙ†Ù†Ù‚Ù„ Ù„Ù„ÙØ§ØªÙˆØ±Ø©
            const btn = document.getElementById('submit-btn');
            if (btn) {
                btn.disabled = false;
                document.getElementById('btn-text').style.display = 'inline';
                document.getElementById('btn-loader').style.display = 'none';
            }
            
            // Ù†Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø© Ø¨Ø¹Ø¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
            cart = [];
            updateCartUI();
            
            // Ù†Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
            socket.emit('request-order-status', orderId);
            
            showPage('invoice-page');
            
            // Ù†Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¤Ù‚Øª Ù„Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù†Ø³ØªØ®Ø¯Ù… ÙˆÙ‚Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡)
            const orderTimeValue = parseInt(localStorage.getItem('orderTime_' + orderId));
            if (orderTimeValue) {
                startEditTimer(orderId, orderTimeValue);
            }
            
            // Ù†Ø­Ø¯Ø« Ø²Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
            updateOrderStatusButton();
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø·Ù„Ø¨ Ù…Ø¹ÙŠÙ† (Ù„Ù„Ø²Ø¨ÙˆÙ†)
        socket.on('order-status-update', (orderData) => {
            // Ø¥Ø°Ø§ Ù‡Ø°Ø§ Ø·Ù„Ø¨ÙŠØŒ Ø£Ø­Ø¯Ø« Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            if (myOrders.includes(orderData.id)) {
                // Ù„Ùˆ Ø§Ù„Ø·Ù„Ø¨ Ø§ÙƒØªÙ…Ù„ (ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…)ØŒ Ù†Ø´ÙŠÙ„Ù‡ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                if (orderData.status === 'completed') {
                    myOrders = myOrders.filter(id => id !== orderData.id);
                    localStorage.setItem('myOrders', JSON.stringify(myOrders));
                    
                    // Ù„Ùˆ ÙƒØ§Ù† Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠØŒ Ù†Ù…Ø³Ø­Ù‡
                    if (currentOrderId === orderData.id) {
                        currentOrderId = null;
                        localStorage.removeItem('currentOrderId');
                    }
                    
                    // Ù†Ø­Ø¯Ø« Ø²Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
                    updateOrderStatusButton();
                }
                
                // Ù„Ùˆ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠØŒ Ù†Ø­Ø¯Ø« Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                if (orderData.id === currentOrderId) {
                    updateInvoiceUI(orderData);
                }
            }
        });

        // Ù„Ù…Ø§ ÙŠØ¬ÙŠ ØªØ­Ø¯ÙŠØ« Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ØŒ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø©ØŒ Ø­Ø°Ù)
        socket.on('order-update', (orders) => {
            console.log('ÙˆØµÙ„ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø·Ù„Ø¨Ø§Øª:', orders.length);
            
            // Ù†Ø´ÙŠÙƒ Ù‡Ù„ ÙÙŠÙ‡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¹Ø´Ø§Ù† Ù†Ø´ØºÙ„ Ø§Ù„ØµÙˆØª
            if (orders.length > allOrders.length) {
                const audio = document.getElementById('notification-sound');
                audio.play().catch(e => console.log('Ù„Ø§Ø²Ù… ØªÙØ§Ø¹Ù„ Ø¹Ø´Ø§Ù† Ø§Ù„ØµÙˆØª ÙŠØ´ØªØºÙ„'));
            }
            
            allOrders = orders; 
            renderAdminOrders(orders);

            // Ù„Ùˆ Ø§Ù„Ø²Ø¨ÙˆÙ† ÙØ§ØªØ­ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŒ Ù†Ø­Ø¯Ø« Ø¨ÙŠØ§Ù†Ø§ØªÙ‡
            if (currentOrderId) {
                const myOrder = orders.find(o => o.id === currentOrderId);
                if (myOrder) {
                    updateInvoiceUI(myOrder);
                }
            }
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
        socket.on('completed-orders', (orders) => {
            console.log('ÙˆØµÙ„Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©:', orders.length);
            renderCompletedOrders(orders);
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø³Ù„Ù…Ø©
        socket.on('undelivered-orders', (orders) => {
            console.log('ÙˆØµÙ„Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø³Ù„Ù…Ø©:', orders.length);
            renderUndeliveredOrders(orders);
        });

        function updateInvoiceUI(order) {
            // ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨
            document.getElementById('invoice-id').innerText = '#' + getShortId(order.id);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø¹ Ø§Ù„Ø®ØªÙ…
            const statusElement = document.getElementById('invoice-status');
            statusElement.innerText = getStatusText(order.status);
            
            // Ù†ØºÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø­Ø§Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„ÙˆØ¶Ø¹
            if (order.status === 'completed') {
                statusElement.style.color = '#4CAF50';
            } else if (order.status === 'undelivered') {
                statusElement.style.color = '#f44336';
            } else if (order.status === 'ready') {
                statusElement.style.color = 'var(--accent-color)';
            } else {
                statusElement.style.color = 'var(--accent-color)';
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙØ§ØµÙŠÙ„ (Ø¹Ø´Ø§Ù† Ù„Ùˆ Ø­Ø¯Ø« Ø§Ù„ØµÙØ­Ø© Ù…Ø§ ØªØ®ØªÙÙŠ)
            const detailsDiv = document.getElementById('invoice-details');
            detailsDiv.innerHTML = order.items.map(item => `
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px; border-bottom: 1px solid #333; padding-bottom: 5px;">
                    <span>${item.name}</span>
                    <span>${item.price} Ø±ÙŠØ§Ù„</span>
                </div>
            `).join('');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹
            document.getElementById('invoice-total').innerText = order.total;
            
            // Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ (Ù„Ùˆ ÙÙŠÙ‡)
            renderOtherOrders();
        }
        
        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ (ØºÙŠØ± Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ)
        function renderOtherOrders() {
            const otherOrdersSection = document.getElementById('other-orders-section');
            const otherOrdersList = document.getElementById('other-orders-list');
            
            if (!otherOrdersSection || !otherOrdersList) return;
            
            // Ù†Ø¬ÙŠØ¨ ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø© ØºÙŠØ± Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
            const otherOrders = myOrders
                .filter(id => id !== currentOrderId)
                .map(id => allOrders.find(o => o.id === id))
                .filter(o => o && ['pending', 'preparing', 'ready'].includes(o.status));
            
            if (otherOrders.length === 0) {
                otherOrdersSection.style.display = 'none';
                return;
            }
            
            otherOrdersSection.style.display = 'block';
            
            otherOrdersList.innerHTML = otherOrders.map(order => {
                const timeAgo = Math.floor((new Date() - new Date(order.timestamp)) / 60000);
                let statusColor = 'var(--accent-color)';
                if (order.status === 'ready') statusColor = '#4CAF50';
                if (order.status === 'preparing') statusColor = '#FF9800';
                
                return `
                <div class="order-card" style="margin-bottom: 15px; cursor: pointer;" onclick="viewOrder('${order.id}')">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 0.8rem; color: #888;">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--accent-color);">#${getShortId(order.id)}</div>
                        </div>
                        <div style="text-align: left;">
                            <div style="font-size: 0.9rem; font-weight: bold; color: ${statusColor};">${getStatusText(order.status)}</div>
                            <div style="font-size: 0.8rem; color: #666;">Ù…Ù†Ø° ${timeAgo} Ø¯Ù‚ÙŠÙ‚Ø©</div>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
        }
        
        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø·Ù„Ø¨ Ù…Ø¹ÙŠÙ†
        function viewOrder(orderId) {
            currentOrderId = orderId;
            localStorage.setItem('currentOrderId', orderId);
            socket.emit('request-order-status', orderId);
        }

    </script>
</body>
</html>
